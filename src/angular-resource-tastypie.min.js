var ngResourceTastypie={name:"Angular Resource Tastypie",description:"RESTful AngularJs client for Django-Tastypie or equivalent schema.",version:{full:"1.0.4",major:1,minor:0,dot:4,codeName:"Cappuccino"},author:{name:"Marcos William Ferretti",email:"ferretti.spo@gmail.com",github:"https://github.com/mw-ferretti/",linkedin:"https://www.linkedin.com/in/mwferretti"},license:"MIT, (c) 2014-2016 Marcos William Ferretti",source:"https://github.com/mw-ferretti/angular-resource-tastypie"};if("undefined"==typeof angular)throw"[ngResourceTastypie v".concat(ngResourceTastypie.version.full,"] Requires AngularJs 1.3+");if(angular.version.major<1||1==angular.version.major&&angular.version.minor<3)throw"[ngResourceTastypie v".concat(ngResourceTastypie.version.full,"] Requires AngularJs 1.3+, your version is ",angular.version.full);angular.module("ngResourceTastypie",["ngResource"]).constant("ngResourceTastypie",ngResourceTastypie).config(["$resourceProvider",function(a){a.defaults.stripTrailingSlashes=!1}]).provider("$tastypie",["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"],a.defaults.headers.common["Content-Type"]="application/json";var b=this,c="",d="",e={username:"",api_key:""};b.providers={},b.default={},b.getProvider=function(a){var c={};if(c="default"==a?b.default||{}:b.providers[a]||{},!c.hasOwnProperty("url"))throw'[$tastypieProvider][GetProvider] provider "'.concat(a,'" not found.');return c},b.setDefault=function(a){if(!b.providers.hasOwnProperty(a))throw"[$tastypieProvider][ProviderSetDefault] Provider ".concat(a," not found.");b.default=b.providers[a],c=b.default.url,d=b.default.domain,e.username=b.default.username,e.api_key=b.default.apikey,"undefined"!=typeof Storage&&(sessionStorage.$tastypieDefaultProvider=angular.toJson(b.default))},b.add=function(a,c){var d=a&&("string"==typeof a||a instanceof String);if(!d)throw'[$tastypieProvider][ProviderAdd] Invalid providerName string. Usage: add("providerName", {url:"address"})';if(!c||!angular.isObject(c)||!c.hasOwnProperty("url"))throw'[$tastypieProvider][ProviderAdd] Invalid providerObj object. Usage: add("providerName", {url:"address"})';if(b.providers[a])return b;c.name=a;var e=document.createElement("a");e.href=c.url;var f=e.protocol.concat("//",e.hostname);return""!=e.port&&(f=f.concat(":",e.port)),c.domain=f,c.hasOwnProperty("headers")||(c.headers={}),c.headers.hasOwnProperty("Content-Type")||(c.headers["Content-Type"]="application/json"),c.hasOwnProperty("username")&&c.hasOwnProperty("apikey")&&(c.headers.Authorization="ApiKey ".concat(c.username,":",c.apikey)),b.providers[a]=c,b.default.hasOwnProperty("name")||b.setDefault(a),"undefined"!=typeof Storage&&(sessionStorage.$tastypieProviders=angular.toJson(b.providers)),b},b.httpExceptions={},b.httpExceptionsAdd=function(a,c){if(!a)throw"[$tastypieProvider][httpExceptionsAdd] Invalid httpCode integer. Usage: httpExceptionsAdd(httpCode, callback)";if(!c||!angular.isFunction(c))throw"[$tastypieProvider][httpExceptionsAdd] Invalid callback function. Usage: httpExceptionsAdd(httpCode, callback)";return b.httpExceptions["c".concat(a)]=c,b},b.setProviderAuth=function(a,c,d){var e=b.getProvider(a);e.username=c,e.apikey=d,e.hasOwnProperty("headers")||(e.headers={}),e.headers.Authorization="ApiKey ".concat(e.username,":",e.apikey),b.providers[a]=e,b.default.name==a&&(b.default=e,"undefined"!=typeof Storage&&(sessionStorage.$tastypieDefaultProvider=angular.toJson(b.default))),"undefined"!=typeof Storage&&(sessionStorage.$tastypieProviders=angular.toJson(b.providers))},b.setResourceUrl=function(a){var e=a&&("string"==typeof a||a instanceof String);if(!e)throw"[$tastypieProvider][SetResourceUrl] Invalid URL.";c=a;var f=document.createElement("a");f.href=c,d=f.protocol.concat("//",f.hostname),""!=f.port&&(d=d.concat(":",f.port)),b.default.name="default",b.default.hasOwnProperty("headers")||(b.default.headers={}),b.default.headers.hasOwnProperty("Content-Type")||(b.default.headers["Content-Type"]="application/json"),b.default.url=a,b.default.domain=d,b.providers[b.default.name]=b.default,"undefined"!=typeof Storage&&(sessionStorage.$tastypieDefaultProvider=angular.toJson(b.default),sessionStorage.$tastypieProviders=angular.toJson(b.providers))},b.setAuth=function(a,c){var d=a&&("string"==typeof a||a instanceof String);c&&("string"==typeof c||c instanceof String);if(!d)throw"[$tastypieProvider][SetResourceUrl] Invalid username.";if(!c)throw"[$tastypieProvider][SetResourceUrl] Invalid apikey.";e.username=a,e.api_key=c,b.default.name="default",b.default.hasOwnProperty("headers")||(b.default.headers={}),b.default.headers.hasOwnProperty("Content-Type")||(b.default.headers["Content-Type"]="application/json"),b.default.username=a,b.default.apikey=c,b.default.headers.Authorization="ApiKey ".concat(a,":",c),b.providers[b.default.name]=b.default,"undefined"!=typeof Storage&&(sessionStorage.$tastypieDefaultProvider=angular.toJson(b.default),sessionStorage.$tastypieProviders=angular.toJson(b.providers))};var f=function(a){if(!angular.isObject(a)||!a.hasOwnProperty("url"))throw"[$tastypieProvider][clearAuthProvider] Invalid provider.";a.hasOwnProperty("username")&&(a.username=""),a.hasOwnProperty("apikey")&&(a.apikey=""),a.hasOwnProperty("headers")&&a.headers.hasOwnProperty("Authorization")&&delete a.headers.Authorization,b.providers[a.name]=a,"undefined"!=typeof Storage&&(sessionStorage.$tastypieProviders=angular.toJson(b.providers)),a.name==b.default.name&&(e.username="",e.api_key="",b.default=a,"undefined"!=typeof Storage&&(sessionStorage.$tastypieDefaultProvider=angular.toJson(b.default)))};b.clearAuthSession=function(a){var c=a&&("string"==typeof a||a instanceof String);if(!c)throw"[$tastypieProvider][ClearAuthSession] Invalid providerName.";if("all"==a)for(var d=Object.keys(b.providers),e=0;e<d.length;e++)f(b.providers[d[e]]);else f(b.getProvider(a))},b.close=function(){b.clearAuthSession("all")},b.getAuth=function(){return e},b.getResourceUrl=function(){return c},b.getResourceDomain=function(){return d},"undefined"!=typeof Storage&&(b.default=angular.fromJson(sessionStorage.$tastypieDefaultProvider)||{},b.providers=angular.fromJson(sessionStorage.$tastypieProviders)||{},c=b.default.url,d=b.default.domain,e.username=b.default.username,e.api_key=b.default.apikey);var g=[];Object.defineProperties(b,{working:{get:function(){return g.length>0},set:function(a){"undefined"==typeof a&&(a=!1),a?g.push(1):g.splice(-1,1)}}}),b.$get=function(){return{providers:b.providers,add:b.add,getProvider:b.getProvider,setDefault:b.setDefault,setProviderAuth:b.setProviderAuth,default:b.default,clearAuthSession:b.clearAuthSession,resource_url:b.getResourceUrl(),resource_domain:b.getResourceDomain(),auth:b.getAuth(),working:b.working,setAuth:b.setAuth,setResourceUrl:b.setResourceUrl,close:b.close,httpExceptionsAdd:b.httpExceptionsAdd,httpExceptions:b.httpExceptions}}}]).factory("$tastypiePaginator",["$resource","$tastypie","$q",function(a,b,c){function d(a,b,c){this.resource=a,this.filters=b||{},this.meta={},this.objects=[],this.index=0,this.length=0,this.range=[],f(this,c)}function e(a){var b=c.defer();return"object"==typeof console&&console.log(a),b.reject({statusText:a}),b.promise}function f(a,b){if(!angular.isObject(b.meta))throw"[$tastypiePaginator] Invalid django-tastypie object.";a.meta=b.meta;for(var c=0;c<b.objects.length;c++)b.objects[c]=a.resource.objects.$create(b.objects[c]);a.objects=b.objects,a.length=Math.ceil(b.meta.total_count/b.meta.limit),0==b.meta.offset?a.index=1:a.index=Math.ceil(b.meta.offset/b.meta.limit)+1;for(var d=[],e=1;e<=a.length;e++)d.push(e);a.range=d}function g(c,d){if(d){c.resource.working=!0;var g=a(d,{},{get:{method:"GET",headers:c.resource.provider.headers}}).get().$promise.then(function(a){return f(c,a),c.resource.working=!1,c},function(a){var d=b.httpExceptions["c".concat(a.status)];d&&angular.isFunction(d)&&d(a),a=a||{},a.statusText="[$tastypiePaginator][$get] ".concat(a.statusText||"Server Not Responding."),c.resource.working=!1;var d=b.httpExceptions["c".concat(a.status)];throw d&&angular.isFunction(d)&&d(a),a});return g}var h="[$tastypiePaginator][$get] ".concat("Invalid url.");return e(h)}function h(c,d,g){if(d==c.index&&!g){var i="[$tastypiePaginator][$get] ".concat("Index ",d," has already been loaded.");return e(i)}if(d>0&&d<=c.length){c.resource.working=!0;var j=angular.copy(c.filters);j.offset=(d-1)*c.meta.limit;var k=a(c.resource.endpoint,c.resource.defaults,{get:{method:"GET",headers:c.resource.provider.headers}}).get(j).$promise.then(function(a){return a.meta.offset==a.meta.total_count?d-1==0?(f(c,a),c.resource.working=!1,c):(c.resource.working=!1,h(c,d-1,!0)):(f(c,a),c.resource.working=!1,c)},function(a){a=a||{},a.statusText="[$tastypiePaginator][$get] ".concat(a.statusText||"Server Not Responding."),c.resource.working=!1;var d=b.httpExceptions["c".concat(a.status)];throw d&&angular.isFunction(d)&&d(a),a});return k}var i="[$tastypiePaginator][$get] ".concat("Index ",d," not exist.");return e(i)}return d.prototype.change=function(a){if(a)return h(this,a,!1);var b="[$tastypiePaginator][change] ".concat('Parameter "index" not informed.');return e(b)},d.prototype.next=function(){if(this.meta.next)return g(this,b.resource_domain.concat(this.meta.next));var a="[$tastypiePaginator][next] ".concat("Not exist next pages.");return e(a)},d.prototype.previous=function(){if(this.meta.previous)return g(this,b.resource_domain.concat(this.meta.previous));var a="[$tastypiePaginator][previous] ".concat("Not exist previous pages.");return e(a)},d.prototype.refresh=function(){return h(this,this.index,!0)},d.prototype.first=function(){return h(this,1,!1)},d.prototype.last=function(){return h(this,this.length,!1)},d}]).factory("$tastypieObjects",["$resource","$tastypiePaginator","$q","$tastypie",function(a,b,c,d){function e(a){this.resource=a}function f(a){var b=c.defer();return"object"==typeof console&&console.log(a),b.reject({statusText:a}),b.promise}function g(b,c){var e={post:{method:"POST",headers:b.resource.provider.headers},save:{method:"POST",headers:b.resource.provider.headers},get:{method:"GET",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")},get_uri:{method:"GET",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")},update:{method:"PATCH",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")},put:{method:"PUT",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")},patch:{method:"PATCH",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")},delete:{method:"DELETE",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")},remove:{method:"DELETE",headers:b.resource.provider.headers,url:b.resource.endpoint.concat(":id/")}},g=a(b.resource.endpoint,{id:"@id"},e);return delete g.prototype.$query,g.prototype.$domain=b.resource.provider.domain,g.prototype.$get=function(a){var c=this;if(angular.extend(c,a||{}),!c.hasOwnProperty("id")){var e="[$tastypieObjects][$get] ".concat("Attribute [id] is required.");return f(e)}b.resource.working=!0;var g=c.$get_uri(c).then(function(a){return b.resource.working=!1,a},function(a){a=a||{},a.statusText="[$tastypieObjects][$get] ".concat(a.statusText||"Server Not Responding."),b.resource.working=!1;var c=d.httpExceptions["c".concat(a.status)];throw c&&angular.isFunction(c)&&c(a),a});return g},g.prototype.$save=function(a){var c=this;angular.extend(c,a||{});var e=c.hasOwnProperty("id")?c.$put():c.$post();b.resource.working=!0;var f=e.then(function(a){return b.resource.working=!1,typeof b.resource.page.refresh==typeof Function&&b.resource.page.refresh(),a},function(a){a=a||{},a.statusText="[$tastypieObjects][$save] ".concat(a.statusText||"Server Not Responding."),b.resource.working=!1;var c=d.httpExceptions["c".concat(a.status)];throw c&&angular.isFunction(c)&&c(a),a});return f},g.prototype.$update=function(a){var c=this;if(angular.extend(c,a||{}),!c.hasOwnProperty("id")||!c.id){var e="[$tastypieObjects][$update] ".concat("Attribute [id] is required.");return f(e)}b.resource.working=!0;var g=c.$patch().then(function(a){return b.resource.working=!1,typeof b.resource.page.refresh==typeof Function&&b.resource.page.refresh(),a},function(a){a=a||{},a.statusText="[$tastypieObjects][$update] ".concat(a.statusText||"Server Not Responding."),b.resource.working=!1;var c=d.httpExceptions["c".concat(a.status)];throw c&&angular.isFunction(c)&&c(a),a});return g},g.prototype.$delete=function(a){var c=this;if(angular.extend(c,a||{}),!c.hasOwnProperty("id")||!c.id){var e="[$tastypieObjects][$delete] ".concat("Attribute [id] is required.");return f(e)}b.resource.working=!0;var g=c.$remove().then(function(a){return b.resource.working=!1,angular.forEach(c,function(a,b){delete c[b]}),typeof b.resource.page.refresh==typeof Function&&b.resource.page.refresh(),a},function(a){a=a||{},a.statusText="[$tastypieObjects][$delete] ".concat(a.statusText||"Server Not Responding."),b.resource.working=!1;var c=d.httpExceptions["c".concat(a.status)];throw c&&angular.isFunction(c)&&c(a),a});return g},g.prototype.$clear=function(){var a=this;angular.forEach(a,function(b,c){delete a[c]})},new g(c)}function h(c){var e=a(c.resource.endpoint,c.resource.defaults,{get:{method:"GET",headers:c.resource.provider.headers},find:{method:"GET",headers:c.resource.provider.headers}});return e.prototype.$find=function(a){c.resource.working=!0;var e=this.$get(a).then(function(d){return c.resource.working=!1,c.resource.page=new b(c.resource,a,d),c.resource.page},function(a){a=a||{},a.statusText="[$tastypieObjects][$find] ".concat(a.statusText||"Server Not Responding."),c.resource.working=!1;var b=d.httpExceptions["c".concat(a.status)];throw b&&angular.isFunction(b)&&b(a),a});return e},new e}return e.prototype.$create=function(a){return g(this,a)},e.prototype.$get=function(a){return g(this).$get(a)},e.prototype.$delete=function(a){return g(this,a).$delete()},e.prototype.$find=function(a){return h(this).$find(a)},e.prototype.$update=function(a){return g(this,a).$update()},e}]).factory("$tastypieResource",["$resource","$tastypie","$tastypiePaginator","$tastypieObjects",function(a,b,c,d){function e(a,c,e){var f=a&&("string"==typeof a||a instanceof String);if(!f)throw"[$tastypieResource] Unknown service name.";this.provider=b.getProvider(e||"default"),this.endpoint=this.provider.url.concat(a,"/"),this.defaults=c||{},this.page={},this.objects=new d(this);var g=[];Object.defineProperties(this,{working:{get:function(){return g.length>0},set:function(a){"undefined"==typeof a&&(a=!1),a?g.push(1):g.splice(-1,1),b.working=a}}})}return e}]);